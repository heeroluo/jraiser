<!DOCTYPE html>
<html lang="zh-hans">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,shrink-to-fit=no" />
<meta name="format-detection" content="telephone=no,email=no" />
<meta name="keywords" content="javascript,jraiser,bowljs,modular,library,cmd,amd,loader,define,require,模块化,加载器" />
<meta name="description" content="基于CMD规范的模块化类库，包含加载器和一些通用性强的基础模块和UI组件。此外还有配套的CLI工具，可用于构建代码和生成API文档。" />
<title>构建 | JRaiser</title>
<link href="/jraiser/style/basic.css?1" media="all" rel="stylesheet" type="text/css" />
<link href="/jraiser/style/common.css?1" media="all" rel="stylesheet" type="text/css" />
</head>

<body>
<!--[if lt IE 9]>
<script>
!function(body) {
	var html = body.parentNode;
	body.style.width = '100%';
	body.style.height = '100%';
	html.style.overflow = body.style.overflow= 'hidden';
}(document.body);
</script>
<iframe src="/4oie.html" frameborder="0" scrolling="no" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0; z-index: 99999;"></iframe>
<![endif]-->
<header class="header">
	<div class="g-boundary g-clearfix">
		<div class="header__logo">
			<a href="/jraiser/">
				<img src="/jraiser/image/logo.png" alt="JRaiser" />
			</a>
		</div>
		<nav class="header__nav">
			<a href="/jraiser/article/list/beginner/quick-start.html" class="header__nav__item header__nav__item__current">教程</a>
			<a href="/jraiser/api/index.html" target="_blank" class="header__nav__item">API文档</a>
			<a href="https://github.com/heeroluo/jraiser/issues" target="_blank" class="header__nav__item">提交Issue</a>
		</nav>
	</div>
</header>
<div class="p-wrapper g-boundary g-clearfix">
	<div id="main" class="p-main">
		<article class="p-article">
	<h1 class="p-article__title">构建</h1>
	<div class="p-article__content"><p>为了提高性能，发布到生产环境的Javascript代码一般要经过压缩等<strong>构建处理</strong>。而模块化的.js文件是比较特殊的，<em>不能</em>直接使用一般的Javascript压缩工具（如UglifyJS）进行压缩。</p>
<h2 id="简单构建"><a href="#简单构建" class="headerlink" title="简单构建"></a>简单构建</h2><p>本类库使用的加载器是 Bowl.js ，可以通过配套的 <strong><a href="https://github.com/heeroluo/bowljs-cli" target="_blank" rel="external">Bowljs CLI</a></strong> 进行构建。安装 Node.js 后，通过 npm 命令安装该工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install bowljs-cli -g</span><br></pre></td></tr></table></figure>
<p>然后通过以下命令就可以把上一节新建的「hello-world-debug.js」构建为「hello-world.js」：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bowljs build &lt;上级路径&gt;/static/modjs/</span><br></pre></td></tr></table></figure>
<p>修改「hello-world.html」中 Bowl.js 的配置（debug设为false），就可以加载构建后的文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bowljs.config(&#123;</span><br><span class="line">    libPath: <span class="string">'modjs/lib'</span>,</span><br><span class="line">    appPath: <span class="string">'modjs/app'</span>,</span><br><span class="line">    preload: [</span><br><span class="line">        <span class="built_in">Function</span>.prototype.bind ? <span class="string">''</span> : <span class="string">'compatibility/es5-shim'</span>,</span><br><span class="line">        <span class="built_in">window</span>.JSON ? <span class="string">''</span> : <span class="string">'compatibility/json2'</span>,</span><br><span class="line">        <span class="built_in">window</span>.localStorage ? <span class="string">''</span> : <span class="string">'compatibility/localstorage'</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 加载构建后的文件</span></span><br><span class="line">    debug: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="合并模块"><a href="#合并模块" class="headerlink" title="合并模块"></a>合并模块</h2><p>构建工具还可以在构建模块的时候把所有或部分依赖的模块合并进来，以节省HTTP请求。合并功能需要配置文件指定<strong>合并规则</strong>，即「lib.settings」和「package.settings」。其中「lib.settings」为类库的合并规则，一般情况下不建议修改。项目本身的合并规则可以写到「package.settings」。</p>
<p>下面修改「package.settings」：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"import"</span>: <span class="string">"./lib.settings"</span>,</span><br><span class="line">    <span class="attr">"app_path"</span>: <span class="string">"./app"</span>,</span><br><span class="line">    <span class="attr">"list"</span>: [</span><br><span class="line">        &#123; <span class="attr">"target"</span>: <span class="string">"^hello-world"</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新构建后，「hello-world.js」中即包含所有依赖的模块。</p>
<p>更多构建配置请参阅 <a href="https://github.com/heeroluo/bowljs-cli/wiki/%E6%9E%84%E5%BB%BA%E9%85%8D%E7%BD%AE" target="_blank" rel="external">Bowljs CLI 构建配置</a> 。</p>
</div>
</article>
<nav class="p-article-adjacent g-clearfix">
	<a href="/jraiser/article/list/beginner/quick-start.html" class="p-article-adjacent__prev">快速上手</a>
	<a href="/jraiser/article/list/advanced/build-by-gulp.html" class="p-article-adjacent__next">与Gulp搭配使用</a>
</nav>
		<script>
		!function() {
			var links = document.querySelectorAll('#main a'), host = window.location.host;
			for (var i = links.length - 1; i >= 0; i--) {
				if (links[i].host !== host) { links[i].target = '_blank'; }
			}
		}();
		</script>
	</div>
	<aside id="sidebar" class="c-sidebar">
	<nav class="c-sidebar__nav">
		<div class="c-sidebar__nav__title">入门</div>
		<ul class="c-sidebar__nav__list">
			<li><a href="/jraiser/article/list/beginner/why-modular.html">为什么模块化</a></li>
			<li><a href="/jraiser/article/list/beginner/quick-start.html">快速上手</a></li>
			<li><a href="/jraiser/article/list/beginner/build.html">构建</a></li>
		</ul>
	</nav>
	<nav class="c-sidebar__nav">
		<div class="c-sidebar__nav__title">进阶</div>
		<ul class="c-sidebar__nav__list">
			<li><a href="/jraiser/article/list/advanced/build-by-gulp.html">与Gulp搭配使用</a></li>
		</ul>
	</nav>
	<nav class="c-sidebar__nav">
		<div class="c-sidebar__nav__title">常见问题</div>
		<ul class="c-sidebar__nav__list">
			<li><a href="/jraiser/article/list/faq/third-party-module.html">调用第三方模块</a></li>
			<li><a href="/jraiser/article/list/faq/about-module-id.html">关于模块ID</a></li>
		</ul>
	</nav>
</aside>
<script>
!function(global) {
	var sideNavLinks = global.document.querySelectorAll('#sidebar a');
	var pathname = global.location.pathname;
	for (var i = sideNavLinks.length - 1; i >= 0; i--) {
		if (sideNavLinks[i].getAttribute('href') === pathname) {
			sideNavLinks[i].parentNode.className = 'sidebar__nav__list__item--current';
			return;
		}
	}
}(window);
</script>
</div>
<footer class="c-footer g-keep-bottom js-keep-bottom">
	<div class="g-boundary g-clearfix">
		<div class="c-footer__copyright">
			<p>Copyright &copy; 2012-2018 <a href="//mrluo.life/" target="_blank">Mr.Luo</a></p>
			<p>Released under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT license</a></p>
		</div>
		<div class="c-footer__related">
			<p>相关链接：</p>
			<ul class="c-footer__related__list g-clearfix">
				<li><a href="https://github.com/heeroluo/bowljs" target="_blank">Bowl.js项目</a></li>
				<li><a href="https://github.com/heeroluo/bowljs-cli" target="_blank">Bowljs CLI项目</a></li>
			</ul>
		</div>
	</div>
</footer>
<script>
!function(global) {
	var body = global.document.body;
	function updateBottomHeight() {
		var elts = body.querySelectorAll('.js-keep-bottom');
		var totalHeight = 0, lastHeight;
		for (var i = elts.length - 1; i >= 0; i--) {
			if (lastHeight) { elts[i].style.bottom = lastHeight + 'px'; }
			lastHeight = elts[i].offsetHeight;
			totalHeight += lastHeight;
		}
		body.style.paddingBottom = totalHeight + 'px';
	}
	global.addEventListener('resize', updateBottomHeight, false);
	updateBottomHeight();
	if (/\bEdge\b/.test(global.navigator.userAgent)) {
		setTimeout(updateBottomHeight, 0);
	}
}(window);
</script>
<div style="display: none;"><script src="//s4.cnzz.com/stat.php?id=4803075&amp;web_id=4803075"></script></div>
</body>
</html>