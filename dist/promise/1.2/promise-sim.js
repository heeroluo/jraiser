define("promise/1.2/promise-sim",["base/1.2/base"],function(n,t,e){"use strict";var i=n("../../base/1.2/base"),r="undefined"!=typeof console&&"function"==typeof console.error?function(n){console.error("Uncaught (in promise) %o",n)}:function(n){throw n};function s(n,t,e){!function i(n){return n&&"function"==typeof n.then}(n)?t(n):n.then(t,e)}var f=i.createClass(function(n){if("function"!=typeof n)throw new Error("Executor must be a function");var t=this;function e(n){t._settle(2,n)}t._status=0,t._pendings={};try{n(function(n){s(n,function(n){t._settle(1,n)},e)},e)}catch(i){e(i)}},{_settle:function(t,e){var i=this;0===i._status&&(i._status=t,i._value=e,setTimeout(function(){if(2!==i._status||i._hasRejectedHandler){var n=i._pendings[t];n&&n.forEach(function(n){n(e)}),delete i._pendings}else r(e)},0))},_listen:function(n,t){var e=this;2===n&&(e._hasRejectedHandler=!0),e._pendings?(e._pendings[n]=e._pendings[n]||[],e._pendings[n].push(t)):e._status===n&&setTimeout(function(){t(e._value)},0)},_then:function(r,u,c){var o=this;return new f(function(e,i){o._listen(1,function(){var n=o._value;if(r)try{n=c&&Array.isArray(n)?r.apply(this,n):r.call(this,n)}catch(t){return void i(t)}s(n,e,i)}),o._listen(2,function(){var n=o._value;if(u){try{n=u.call(this,n)}catch(t){return void i(t)}s(n,e,i)}else i(n)})})},then:function(n,t){return this._then(n,t)},spread:function(n){return this._then(n,null,!0)},"catch":function(n){return this.then(null,n)},"finally":function(u){var c=this;return new f(function(i,r){function n(){var n,t=c._value;switch(c._status){case 1:n=function(){i(t)};break;case 2:n=function(){r(t)}}if(u)try{u()}catch(e){return void r(e)}n&&n()}c._listen(1,n),c._listen(2,n)})}});i.extend(f,{all:function(n){var u=n.length;return u?new f(function(e,i){var r=new Array(u);n.forEach(function(n,t){n.then(function(n){r[t]=n,--u||e(r)},i)})}):f.resolve([])},race:function(n){return new f(function(t,e){n.forEach(function(n){n.then(t,e)})})},resolve:function(e){return new f(function(n,t){s(e,n,t)})},reject:function(e){return new f(function(n,t){t(e)})}}),e.exports=f});