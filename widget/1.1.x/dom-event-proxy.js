/*!
 * JRaiser 2 Javascript Library
 * dom-event-proxy - v1.0.0 (2015-07-10T15:41:02+0800)
 * http://jraiser.org/ | Released under MIT license
 */
define("widget/1.1.x/dom-event-proxy",["dom/1.1.x/"],function(e,n,t){"use strict";function i(e){return"string"==typeof e&&(e=e.trim().split(/\s+/)),e.length?e:void 0}var r=e("base/1.1.x/"),o=e("dom/1.1.x/");return r.createClass(function(){this._init()},{_init:function(){this._elementRecords=[],this._eventRecords=[],this._handlerRecords={}},_createHandler:function(e){var n=this._handlerRecords;switch(typeof e){case"string":if(n[e])return n[e];throw new Error('handler "'+e+'" does not exist');case"function":e={fn:e};break;default:e={id:e.id,fn:e.fn}}if(e.id=e.id||r.randomStr(),n[e.id])throw new Error('handler "'+e+'" already exists');return e.counter=0,n[e.id]=e,e},on:function(e,n,t,r){var c=this._elementRecords,s=this._eventRecords,f=this._createHandler(t);return n=i(n),e.forEach(function(e){var t,i=c.indexOf(e);-1===i&&(i=c.push(e)-1,s[i]={}),t=s[i],e=o(e),n.forEach(function(n){t[n]=t[n]||{},t[n][f.id]||(t[n][f.id]=!0,f.counter++,e.on(n,f.fn,r))})}),this},off:function(e,n,t){var c=this._elementRecords,s=this._eventRecords,f=this._handlerRecords;arguments.length?(n&&(n=i(n)),e.forEach(function(e){var t=c.indexOf(e);-1!==t&&(e=o(e),r.each(s[t],function(i,o){n&&-1===n.indexOf(o)||(r.each(i,function(n,t){var r=f[t];e.off(o,r.fn),delete i[t],--r.counter<=0&&delete f[t]}),r.isEmptyObject(i)&&delete s[t][o])}),r.isEmptyObject(s[t])&&(c.splice(t,1),s.splice(t,1)))})):(c.forEach(function(e,n){e=o(e),r.each(s[n],function(n,t){r.each(n,function(n,i){e.off(t,f[i].fn)})})}),this._init())}})});