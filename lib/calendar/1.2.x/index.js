/*!
 * JRaiser 2 Javascript Library
 * calendar@1.2.0 (2016-06-21T15:15:46+0800)
 * http://jraiser.org/ | Released under MIT license
 */
define("calendar/1.2.x/",["dom/1.1.x/dom","tmpl/2.1.x/tmpl","widget/1.1.x/widget"],function(e,t,a){"use strict";function s(e){var t=n.extend({},e);return t.tags=t.tags.slice(),t}var n=e("base@1.1.x"),r=e("dom@1.1.x"),i=e("tmpl@2.1.x"),d=e("widget@1.1.x"),o=new i({table:'<table class="ui-calendar"<%-tableAttrs%>><% if (weekDayTitles) { %><thead class="ui-calendar__head"><tr><% weekDayTitles.forEach(function(title) { %><th class="ui-calendar__head__grid"><span class="ui-calendar__head__grid__inner"><%=title%></span></th><% }); %></tr></thead><% } %><tbody class="ui-calendar__body"><% weeks.forEach(function(week) { %><tr><% week.forEach(function(dateObj) { %><td class="ui-calendar__body__date<% if (dateObj.tags) { %> <%=dateObj.tags.map(function(tag) { return "ui-calendar__body__date--" + tag; }).join(" ")%><% } %>"><span class="ui-calendar__body__date__inner"><%=dateObj.date%></span></td><% }); %></tr><% }); %></tbody></table>'}),l=/^([+-])(\d+)$/,_="ui-calendar__body__date--selected";return d.create({_init:function(e){var t=new Date;this.year(e.year||t.getFullYear()),this.month(e.month||t.getMonth()+1),e.customTags&&!n.isArray(e.customTags)&&(e.customTags=[e.customTags]),this.render(),0!==e.date&&this._selectDate(e.date||t.getDate())},_destroy:function(){this._$table.remove()},_buildModel:function(){var e=this._options,t=this.year(),a=this.month(),n=new Date(t,a-1,1),r=n.getDay(),i=new Date(t,a-1,1-r).getTime();n.setMonth(a),n.setDate(0),r=n.getDay();var d,o,l,_,c=new Date(t,a-1,n.getDate()+6-r).getTime(),u={year:t,month:a,weeks:[]},h=864e5,g=new Date;for(g.setHours(0,0,0,0),g=g.getTime();i<=c;)d=new Date(i),l={year:d.getFullYear(),month:d.getMonth()+1,date:d.getDate(),day:d.getDay(),timestamp:i,tags:[]},l.dayTitle=e.weekDayTitles[l.day],l.tags.push(l.day>0&&l.day<6?"weekday":"weekend"),l.year===t&&l.month===a||l.tags.push("overflow"),_=l.timestamp>g?"future":l.timestamp<g?"past":"today",l.tags.push(_),e.customTags&&e.customTags.forEach(function(e){var t=e(s(l));null!=t&&""!==t&&l.tags.push(t)}),o&&7!==o.length||(o=[],u.weeks.push(o)),l.rowIndex=u.weeks.length-1,l.colIndex=o.push(l)-1,i+=h;return u},render:function(){var e=this,t=e._options,a=e._model=e._buildModel({year:e._year,month:e._month,customTags:t.customTags});a.weekDayTitles=t.weekDayTitles,a.tableAttrs="",t.tableAttrs&&n.each(t.tableAttrs,function(e,t){a.tableAttrs+=" "+t+'="'+e+'"'}),e._$table&&e._$table.remove(),e._$table=r(o.render("table",a)).appendTo(t.$appendTo),e._$table.on("click",function(t){t.preventDefault();var a=r(this);e._selectDate(t,a.parent().index(),a.index(),a)},{delegator:".ui-calendar__body__date"}),e._trigger("render",{table:e._$table})},_selectDate:function(e,t,a,n){var r=this,i=r._model;"number"==typeof e&&(i.weeks.some(function(s,n){return s.some(function(s,r){s.date===e&&s.month===i.month&&s.year===i.year&&(t=n,a=r)})}),n=r._$table.find("tbody tr").eq(t).find("td").eq(a),e=null);var d;try{d=i.weeks[t][a]}catch(o){}if(d){var o=r._trigger("dateselect",{sourceEvent:e,selectedDate:s(d)});o.isDefaultPrevented()||(r._selectedDate=d,r._$table.find("tbody td").removeClass(_),n.addClass(_))}},year:function(e){return arguments.length?void(this._year=l.test(e)?this._year+parseInt(e):parseInt(e)):this._year},month:function(e){if(!arguments.length)return this._month;var t=l.test(e)?this._month+parseInt(e):parseInt(e),a=new Date(this._year,t-1);this._year=a.getFullYear(),this._month=a.getMonth()+1},selectedDate:function(){return this._selectedDate?s(this._selectedDate):null}},{weekDayTitles:"日一二三四五六".split("")})});