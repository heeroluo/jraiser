/*!
 * JRaiser 2 Javascript Library
 * calendar - v1.1.0 (2015-08-04T10:40:03+0800)
 * http://jraiser.org/ | Released under MIT license
 */
define("calendar/1.1.x/",["dom/1.1.x/","tmpl/2.1.x/","widget/1.1.x/"],function(e,t,a){"use strict";var n=e("base/1.1.x/"),s=e("dom/1.1.x/"),r=e("tmpl/2.1.x/"),o=e("widget/1.1.x/"),d=new r({table:'<table class="ui-calendar"<%-tableAttrs%>><% if (weekDayNames) { %><thead class="ui-calendar__head"><tr><% weekDayNames.forEach(function(name) { %><th class="ui-calendar__head__grid"><span class="ui-calendar__head__grid__inner"><%=name%></span></th><% }); %></tr></thead><% } %><tbody class="ui-calendar__body"><% weeks.forEach(function(week) { %><tr><% week.forEach(function(dateObj) { %><td class="ui-calendar__body__date<% if (dateObj.tags) { %> <%=dateObj.tags.map(function(tag) { return "ui-calendar__body__date--" + tag; }).join(" ")%><% } %>"><span class="ui-calendar__body__date__inner"><%=dateObj.date%></span></td><% }); %></tr><% }); %></tbody></table>'}),i=/^([+-])(\d+)$/;return o.create({_init:function(e){var t=new Date;this.year(e.year||t.getFullYear()),this.month(e.month||t.getMonth()+1),e.customTags&&!n.isArray(e.customTags)&&(e.customTags=[e.customTags])},_destroy:function(e){this._calendarTable.remove()},_buildModel:function(){var e=this._options,t=this.year(),a=this.month(),n=new Date(t,a-1,1),s=n.getDay(),r=["sun","mon","tues","wed","thur","fri","sat"],o=new Date(t,a-1,1-s).getTime();n.setMonth(a),n.setDate(0),s=n.getDay();var d,i,u,l,h=new Date(t,a-1,n.getDate()+6-s).getTime(),_={year:t,month:a,weeks:[]},c=864e5,m=new Date;for(m.setHours(0,0,0,0),m=m.getTime();h>=o;)d=new Date(o),u={year:d.getFullYear(),month:d.getMonth()+1,date:d.getDate(),day:d.getDay(),timestamp:o,tags:[]},u.tags.push("week-"+r[u.day]),u.tags.push(u.day>0&&u.day<6?"weekday":"weekend"),l=u.year<t||u.year===t&&u.month<a?"last-month":u.year>t||u.year===t&&u.month>a?"next-month":"current-month",u.tags.push(l),l=u.timestamp>m?"future":u.timestamp<m?"past":"today",u.tags.push(l),e.customTags&&e.customTags.forEach(function(e){var t=e(new Date(o));null!=t&&""!==t&&u.tags.push(t)}),i&&7!==i.length||(i=[],_.weeks.push(i)),i.push(u),o+=c;return _},render:function(){var e=this,t=e._options;e._offDOMEvent();var a=e._buildModel({year:e._year,month:e._month,customTags:t.customTags});a.weekDayNames=t.weekDayNames,a.tableAttrs="",t.tableAttrs&&n.each(t.tableAttrs,function(e,t){a.tableAttrs+=" "+t+'="'+e+'"'}),e._calendarTable&&e._calendarTable.remove(),e._calendarTable=s(d.render("table",a)).appendTo(t.appendTo),e._onDOMEvent(e._calendarTable.find(".ui-calendar__body__date"),"click",function(r){r.preventDefault();var o=s(this),d=o.index(),i=o.parent().index(),u=a.weeks[i][d];e._trigger("dateselect",{sourceEvent:r,selectedDate:n.extend({dayName:t.weekDayNames[u.day]},u)})}),e._trigger("render",{table:e._calendarTable})},year:function(e){return arguments.length?void(this._year=i.test(e)?this._year+parseInt(e):parseInt(e)):this._year},month:function(e){if(!arguments.length)return this._month;var t=i.test(e)?this._month+parseInt(e):parseInt(e),a=new Date(this._year,t-1);this._year=a.getFullYear(),this._month=a.getMonth()+1}},{weekDayNames:"日一二三四五六".split("")})});