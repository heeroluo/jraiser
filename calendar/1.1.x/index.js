/*!
 * JRaiser 2 Javascript Library
 * calendar - v1.1.0 (2015-07-30T17:40:29+0800)
 * http://jraiser.org/ | Released under MIT license
 */
define("calendar/1.1.x/",["dom/1.1.x/","tmpl/2.1.x/","widget/1.1.x/"],function(e,t,a){"use strict";var n=e("base/1.1.x/"),s=e("dom/1.1.x/"),r=e("tmpl/2.1.x/"),i=e("widget/1.1.x/"),o=new r({table:'<table class="ui-calendar"<%-tableAttrs%>><% if (weekDayNames) { %><thead class="ui-calendar__head"><tr><% weekDayNames.forEach(function(name) { %><th class="ui-calendar__head__grid"><span class="ui-calendar__head__grid__inner"><%=name%></span></th><% }); %></tr></thead><% } %><tbody class="ui-calendar__body"><% weeks.forEach(function(week) { %><tr><% week.forEach(function(dateObj) { %><td class="ui-calendar__body__date<% if (dateObj.tags) { %> <%=dateObj.tags.map(function(tag) { return "ui-calendar__body__date--" + tag; }).join(" ")%><% } %>"><span class="ui-calendar__body__date__inner"><%=dateObj.date%></span></td><% }); %></tr><% }); %></tbody></table>'}),d=/^([+-])(\d+)$/;return i.create({_init:function(e){var t=new Date;this.year(e.year||t.getFullYear()),this.month(e.month||t.getMonth()+1),e.customTags&&!n.isArray(e.customTags)&&(e.customTags=[e.customTags])},_destroy:function(e){e.wrapper.empty()},_buildModel:function(){var e=this._options,t=this.year(),a=this.month(),n=new Date(t,a-1,1),s=n.getDay(),r=["sun","mon","tues","wed","thur","fri","sat"],i=new Date(t,a-1,1-s).getTime();n.setMonth(a),n.setDate(0),s=n.getDay();var o,d,u,h,_=new Date(t,a-1,n.getDate()+6-s).getTime(),c={year:t,month:a,weeks:[]},m=864e5,l=new Date;for(l.setHours(0,0,0,0),l=l.getTime();_>=i;)o=new Date(i),u={year:o.getFullYear(),month:o.getMonth()+1,date:o.getDate(),day:o.getDay(),timestamp:i,tags:[]},u.tags.push("week-"+r[u.day]),u.tags.push(u.day>0&&u.day<6?"weekday":"weekend"),h=u.year<t||u.year===t&&u.month<a?"last-month":u.year>t||u.year===t&&u.month>a?"next-month":"current-month",u.tags.push(h),h=u.timestamp>l?"future":u.timestamp<l?"past":"today",u.tags.push(h),e.customTags&&e.customTags.forEach(function(e){var t=e(new Date(i));null!=t&&""!==t&&u.tags.push(t)}),d&&7!==d.length||(d=[],c.weeks.push(d)),d.push(u),i+=m;return c},render:function(){var e=this,t=e._options;e._offDOMEvent();var a=e._buildModel({year:e._year,month:e._month,customTags:t.customTags});a.weekDayNames=t.weekDayNames,a.tableAttrs="",t.tableAttrs&&n.each(t.tableAttrs,function(e,t){a.tableAttrs+=" "+t+'="'+e+'"'});var r=s(o.render("table",a));e._onDOMEvent(r.find(".ui-calendar__body__date"),"click",function(r){r.preventDefault();var i=s(this),o=i.index(),d=i.parent().index(),u=a.weeks[d][o];e._trigger("dateselect",{sourceEvent:r,selectedDate:n.extend({dayName:t.weekDayNames[u.day]},u)})}),t.wrapper.html("").append(r),e._trigger("render",{table:r})},year:function(e){return arguments.length?void(this._year=d.test(e)?this._year+parseInt(e):parseInt(e)):this._year},month:function(e){if(!arguments.length)return this._month;var t=d.test(e)?this._month+parseInt(e):parseInt(e),a=new Date(this._year,t-1);this._year=a.getFullYear(),this._month=a.getMonth()+1}},{weekDayNames:"日一二三四五六".split("")})});